; This is a streamlined php.ini for Absi Technology Moodle.
; Based on php.ini-production from PHP distribution.

; PHP Core settings (configurable via environment variables)
[PHP]
engine = On
short_open_tag = Off
precision = 14
output_buffering = {{PHP_OUTPUT_BUFFERING}}
zlib.output_compression = Off
implicit_flush = Off
unserialize_callback_func =
serialize_precision = -1
disable_functions =
disable_classes =
expose_php = Off
max_execution_time = {{PHP_MAX_EXECUTION_TIME}}
max_input_time = {{PHP_MAX_INPUT_TIME}}
memory_limit = {{PHP_MEMORY_LIMIT}}
; Variable: PHP_ERROR_REPORTING (default: E_ALL & ~E_NOTICE & ~E_STRICT & ~E_DEPRECATED)
error_reporting = E_ALL & ~E_NOTICE & ~E_STRICT & ~E_DEPRECATED
display_errors = {{PHP_DISPLAY_ERRORS}}
display_startup_errors = Off
log_errors = {{PHP_LOG_ERRORS}}
log_errors_max_len = 1024
ignore_repeated_errors = Off
ignore_repeated_source = Off
report_memleaks = On
variables_order = "GPCS"
request_order = "GP"
register_argc_argv = Off
auto_globals_jit = On
post_max_size = {{PHP_POST_MAX_SIZE}}
auto_prepend_file =
auto_append_file =
default_mimetype = "text/html"
default_charset = "UTF-8"

; Mbstring configuration for proper Unicode support
mbstring.language = "UTF-8"
mbstring.internal_encoding = "UTF-8"
mbstring.http_input = "UTF-8"
mbstring.http_output = "UTF-8"
mbstring.encoding_translation = On
mbstring.detect_order = "UTF-8,ASCII"
mbstring.substitute_character = "none"
include_path = ".:/usr/share/php"
doc_root =
user_dir =
enable_dl = Off
file_uploads = On
upload_max_filesize = {{PHP_UPLOAD_MAX_FILESIZE}}
max_file_uploads = {{PHP_MAX_FILE_UPLOADS}}
allow_url_fopen = On
allow_url_include = Off
default_socket_timeout = {{PHP_DEFAULT_SOCKET_TIMEOUT}}

; Resource Limits (configurable via environment variables)
max_input_vars = {{PHP_MAX_INPUT_VARS}}

; Error reporting and logging
error_reporting = E_ALL & ~E_NOTICE & ~E_STRICT & ~E_DEPRECATED
display_errors = Off
display_startup_errors = Off
log_errors = On
error_log = /dev/stderr ; Logs to stderr, picked up by Docker logs
report_memleaks = On
track_errors = Off
html_errors = Off

; Data Handling
variables_order = "GPCS"
request_order = "GP"
register_argc_argv = Off
auto_globals_jit = On
post_max_size = 50M ; Configured by script
gpc_order = "GPC"
enable_post_data_reading = On

; Paths and Directories
upload_tmp_dir = /tmp ; Moodle usually expects moodledata/temp
upload_max_filesize = 40M ; Configured by script

; File Uploads
file_uploads = On

; Session management optimized for load balancing
session.auto_start = Off
session.cookie_lifetime = 0
session.cookie_path = /
session.cookie_domain =
session.cookie_httponly = 1
session.cookie_samesite = "Lax"
session.gc_probability = 1
session.gc_divisor = 1000
session.gc_maxlifetime = 7200
session.save_handler = files
session.save_path = "{{MOODLE_DATA_DIR}}/sessions" ; Shared session storage
session.sid_length = 32
session.sid_bits_per_character = 6

; Date and Time
date.timezone = {{SYSTEM_TIMEZONE}}

; Opcache (highly recommended for performance)
[opcache]
opcache.enable=1
opcache.memory_consumption=128
opcache.interned_strings_buffer=8
opcache.max_accelerated_files=4000
opcache.revalidate_freq=60
opcache.fast_shutdown=1
opcache.enable_cli=1

; Other extensions and settings specific to Moodle requirements or performance
; (e.g., pdo_mysql, mysqli are often included by default)
;extension=mysqli
;extension=gd
;extension=curl
;extension=zip
;extension=xml
;extension=mbstring
;extension=soap
;extension=intl
;extension=json
